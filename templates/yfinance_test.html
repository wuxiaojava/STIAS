<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>yfinanceæ¥å£æµ‹è¯•å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #181c24; color: #e4e7eb; font-family: 'Segoe UI',sans-serif; }
        .card { background: #232a36; color: #e4e7eb; margin-bottom: 16px; border: 1px solid #2d3748; }
        .card-header { background: #2d3748; border-bottom: 1px solid #4a5568; }
        .form-label { color: #00d4aa; font-weight: bold; }
        .result-json { background: #222; color: #aaffcc; font-size: 12px; border-radius: 6px; padding: 12px; overflow-x: auto; max-height: 300px; }
        .table-dark th, .table-dark td { color: #e4e7eb; font-size: 12px; }
        .btn-test { background: #00d4aa; border: none; color: #1a202c; font-weight: bold; }
        .btn-test:hover { background: #00b894; }
        .btn-test:disabled { background: #4a5568; color: #a0aec0; }
        .method-description { color: #a0aec0; font-size: 12px; margin-top: 4px; }
        .loading { color: #fbbf24; }
        .error { color: #f56565; }
        .success { color: #48bb78; }
        .param-group { background: #1a202c; padding: 8px; border-radius: 4px; margin-bottom: 8px; }
        .param-label { color: #a0aec0; font-size: 11px; margin-bottom: 2px; }
        .param-input { background: #2d3748; border: 1px solid #4a5568; color: #e4e7eb; font-size: 12px; }
        .param-input:focus { background: #2d3748; border-color: #00d4aa; color: #e4e7eb; box-shadow: none; }
        .param-row { display: flex; gap: 8px; align-items: end; }
        .param-col { flex: 1; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 4px; }
        .form-check-input { background-color: #2d3748; border-color: #4a5568; }
        .form-check-input:checked { background-color: #00d4aa; border-color: #00d4aa; }
        .data-analysis { background: #1a202c; padding: 12px; border-radius: 6px; margin-top: 8px; }
        .analysis-title { color: #00d4aa; font-weight: bold; margin-bottom: 8px; }
        .analysis-item { margin-bottom: 6px; font-size: 12px; }
        .analysis-label { color: #a0aec0; }
        .analysis-value { color: #e4e7eb; font-weight: bold; }
        .data-preview { max-height: 200px; overflow-y: auto; }
        .export-btn { background: #3182ce; border: none; color: white; font-size: 11px; padding: 4px 8px; }
        .export-btn:hover { background: #2c5aa0; }
        .field-info { color: #a0aec0; font-size: 11px; margin-top: 4px; }
        .numeric-cell { text-align: right; }
        .date-cell { color: #fbbf24; }
        .positive { color: #48bb78; }
        .negative { color: #f56565; }
        .tab-content { background: #1a202c; border-radius: 4px; padding: 8px; }
        .nav-tabs .nav-link { color: #a0aec0; background: #2d3748; border: 1px solid #4a5568; }
        .nav-tabs .nav-link.active { color: #00d4aa; background: #1a202c; border-color: #00d4aa; }
    </style>
</head>
<body>
<div class="container-fluid py-4">
    <h2 class="mb-4" style="color:#00d4aa;">yfinanceæ¥å£æµ‹è¯•å·¥å…·</h2>
    
    <!-- å…¨å±€å‚æ•°è®¾ç½® -->
    <div class="row mb-4">
        <div class="col-md-3">
            <label class="form-label">è‚¡ç¥¨/æŒ‡æ•°ä»£ç </label>
            <input id="symbol" class="form-control" placeholder="å¦‚AAPLã€^GSPCã€MSFT" value="AAPL">
        </div>
        <div class="col-md-3">
            <label class="form-label">æ“ä½œ</label>
            <div>
                <button class="btn btn-test me-2" onclick="testAllYF()">ä¸€é”®æµ‹è¯•æ‰€æœ‰</button>
                <button class="btn btn-secondary" onclick="clearAllResults()">æ¸…ç©ºç»“æœ</button>
            </div>
        </div>
    </div>

    <!-- æ¥å£æµ‹è¯•åŒºåŸŸ -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“ˆ å†å²æ•°æ®</h5>
                    <div class="method-description">è·å–è‚¡ç¥¨å†å²ä»·æ ¼æ•°æ®</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å‘¨æœŸ (period)</div>
                                <select id="history_period" class="form-control param-input">
                                    <option value="1d">1d</option>
                                    <option value="5d">5d</option>
                                    <option value="1mo">1mo</option>
                                    <option value="3mo">3mo</option>
                                    <option value="6mo">6mo</option>
                                    <option value="1y" selected>1y</option>
                                    <option value="2y">2y</option>
                                    <option value="5y">5y</option>
                                    <option value="10y">10y</option>
                                    <option value="ytd">ytd</option>
                                    <option value="max">max</option>
                                </select>
                            </div>
                            <div class="param-col">
                                <div class="param-label">é—´éš” (interval)</div>
                                <select id="history_interval" class="form-control param-input">
                                    <option value="1m">1m</option>
                                    <option value="2m">2m</option>
                                    <option value="5m">5m</option>
                                    <option value="15m">15m</option>
                                    <option value="30m">30m</option>
                                    <option value="60m">60m</option>
                                    <option value="90m">90m</option>
                                    <option value="1h">1h</option>
                                    <option value="1d" selected>1d</option>
                                    <option value="5d">5d</option>
                                    <option value="1wk">1wk</option>
                                    <option value="1mo">1mo</option>
                                    <option value="3mo">3mo</option>
                                </select>
                            </div>
                        </div>
                        <div class="param-row mt-2">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="history_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="history_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                        <div class="param-row mt-2">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="history_prepost" class="form-check-input">
                                <label class="param-label mb-0">åŒ…å«ç›˜å‰ç›˜å (prepost)</label>
                            </div>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="history_actions" class="form-check-input" checked>
                                <label class="param-label mb-0">åŒ…å«å…¬å¸è¡Œä¸º (actions)</label>
                            </div>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="history_auto_adjust" class="form-check-input" checked>
                                <label class="param-label mb-0">è‡ªåŠ¨è°ƒæ•´ (auto_adjust)</label>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm" onclick="testMethod('history')">æµ‹è¯• history</button>
                    <div id="yf_history_result" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">â„¹ï¸ åŸºæœ¬ä¿¡æ¯</h5>
                    <div class="method-description">è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯</div>
                </div>
                <div class="card-body">
                    <button class="btn btn-test btn-sm" onclick="testMethod('info')">æµ‹è¯• info</button>
                    <div id="yf_info_result" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“Š å…¬å¸è¡Œä¸º</h5>
                    <div class="method-description">è‚¡ç¥¨åˆ†å‰²ã€è‚¡æ¯ç­‰å…¬å¸è¡Œä¸º</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="actions_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="actions_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('actions')">æµ‹è¯• actions</button>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('dividends')">æµ‹è¯• dividends</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('splits')">æµ‹è¯• splits</button>
                    <div id="yf_actions_result" class="mt-2"></div>
                    <div id="yf_dividends_result" class="mt-2"></div>
                    <div id="yf_splits_result" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ’° è´¢åŠ¡æ•°æ®</h5>
                    <div class="method-description">è´¢åŠ¡æŠ¥è¡¨æ•°æ®</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="financials_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="financials_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('financials')">æµ‹è¯• financials</button>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('balance_sheet')">æµ‹è¯• balance_sheet</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('cashflow')">æµ‹è¯• cashflow</button>
                    <div id="yf_financials_result" class="mt-2"></div>
                    <div id="yf_balance_sheet_result" class="mt-2"></div>
                    <div id="yf_cashflow_result" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“… å­£åº¦è´¢åŠ¡</h5>
                    <div class="method-description">å­£åº¦è´¢åŠ¡æŠ¥è¡¨æ•°æ®</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="quarterly_financials_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="quarterly_financials_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('quarterly_financials')">æµ‹è¯• quarterly_financials</button>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('quarterly_balance_sheet')">æµ‹è¯• quarterly_balance_sheet</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('quarterly_cashflow')">æµ‹è¯• quarterly_cashflow</button>
                    <div id="yf_quarterly_financials_result" class="mt-2"></div>
                    <div id="yf_quarterly_balance_sheet_result" class="mt-2"></div>
                    <div id="yf_quarterly_cashflow_result" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“ˆ æ”¶ç›Šæ•°æ®</h5>
                    <div class="method-description">æ”¶ç›ŠæŠ¥å‘Šæ•°æ®</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="earnings_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="earnings_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('earnings')">æµ‹è¯• earnings</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('quarterly_earnings')">æµ‹è¯• quarterly_earnings</button>
                    <div id="yf_earnings_result" class="mt-2"></div>
                    <div id="yf_quarterly_earnings_result" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸŒ± å¯æŒç»­å‘å±•</h5>
                    <div class="method-description">ESGå’Œå¯æŒç»­å‘å±•æ•°æ®</div>
                </div>
                <div class="card-body">
                    <button class="btn btn-test btn-sm" onclick="testMethod('sustainability')">æµ‹è¯• sustainability</button>
                    <div id="yf_sustainability_result" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“… æ—¥å†ä¿¡æ¯</h5>
                    <div class="method-description">æ”¶ç›Šæ—¥æœŸå’Œæ—¥å†ä¿¡æ¯</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="calendar_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="calendar_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('calendar')">æµ‹è¯• calendar</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('get_earnings_dates')">æµ‹è¯• get_earnings_dates</button>
                    <div id="yf_calendar_result" class="mt-2"></div>
                    <div id="yf_get_earnings_dates_result" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ”— æ ‡è¯†ä¿¡æ¯</h5>
                    <div class="method-description">ISINä»£ç å’ŒæœŸæƒä¿¡æ¯</div>
                </div>
                <div class="card-body">
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('isin')">æµ‹è¯• isin</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('options')">æµ‹è¯• options</button>
                    <div id="yf_isin_result" class="mt-2"></div>
                    <div id="yf_options_result" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ‘¥ è‚¡ä¸œä¿¡æ¯</h5>
                    <div class="method-description">æœºæ„å’Œä¸ªäººè‚¡ä¸œæ•°æ®</div>
                </div>
                <div class="card-body">
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('institutional_holders')">æµ‹è¯• institutional_holders</button>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('mutualfund_holders')">æµ‹è¯• mutualfund_holders</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('major_holders')">æµ‹è¯• major_holders</button>
                    <div id="yf_institutional_holders_result" class="mt-2"></div>
                    <div id="yf_mutualfund_holders_result" class="mt-2"></div>
                    <div id="yf_major_holders_result" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“° æ–°é—»æ¨è</h5>
                    <div class="method-description">åˆ†æå¸ˆæ¨èå’Œæ–°é—»</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="recommendations_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="recommendations_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('recommendations')">æµ‹è¯• recommendations</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('news')">æµ‹è¯• news</button>
                    <div id="yf_recommendations_result" class="mt-2"></div>
                    <div id="yf_news_result" class="mt-2"></div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“Š æ–°è´¢åŠ¡æ¥å£</h5>
                    <div class="method-description">æ–°ç‰ˆè´¢åŠ¡æŠ¥è¡¨æ¥å£</div>
                </div>
                <div class="card-body">
                    <div class="param-group">
                        <div class="param-row">
                            <div class="param-col">
                                <div class="param-label">å¼€å§‹æ—¥æœŸ (start)</div>
                                <input id="get_income_stmt_start" type="date" class="form-control param-input">
                            </div>
                            <div class="param-col">
                                <div class="param-label">ç»“æŸæ—¥æœŸ (end)</div>
                                <input id="get_income_stmt_end" type="date" class="form-control param-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('get_income_stmt')">æµ‹è¯• get_income_stmt</button>
                    <button class="btn btn-test btn-sm me-2" onclick="testMethod('get_balance_sheet')">æµ‹è¯• get_balance_sheet</button>
                    <button class="btn btn-test btn-sm" onclick="testMethod('get_cashflow')">æµ‹è¯• get_cashflow</button>
                    <div id="yf_get_income_stmt_result" class="mt-2"></div>
                    <div id="yf_get_balance_sheet_result" class="mt-2"></div>
                    <div id="yf_get_cashflow_result" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const YF_METHODS = [
    {name:'history', params:['period','interval','start','end','prepost','actions','auto_adjust','back_adjust','repair','keepna','proxy','rounding','timeout','session','progress','show_errors'], description:'å†å²ä»·æ ¼æ•°æ®'},
    {name:'info', params:[], description:'åŸºæœ¬ä¿¡æ¯'},
    {name:'actions', params:['start','end'], description:'å…¬å¸è¡Œä¸º'},
    {name:'dividends', params:['start','end'], description:'è‚¡æ¯æ•°æ®'},
    {name:'splits', params:['start','end'], description:'è‚¡ç¥¨åˆ†å‰²'},
    {name:'financials', params:['start','end'], description:'è´¢åŠ¡æŠ¥è¡¨'},
    {name:'balance_sheet', params:['start','end'], description:'èµ„äº§è´Ÿå€ºè¡¨'},
    {name:'cashflow', params:['start','end'], description:'ç°é‡‘æµé‡è¡¨'},
    {name:'quarterly_financials', params:['start','end'], description:'å­£åº¦è´¢åŠ¡æŠ¥è¡¨'},
    {name:'quarterly_balance_sheet', params:['start','end'], description:'å­£åº¦èµ„äº§è´Ÿå€ºè¡¨'},
    {name:'quarterly_cashflow', params:['start','end'], description:'å­£åº¦ç°é‡‘æµé‡è¡¨'},
    {name:'earnings', params:['start','end'], description:'æ”¶ç›Šæ•°æ®'},
    {name:'quarterly_earnings', params:['start','end'], description:'å­£åº¦æ”¶ç›Š'},
    {name:'sustainability', params:[], description:'å¯æŒç»­å‘å±•'},
    {name:'calendar', params:['start','end'], description:'æ—¥å†ä¿¡æ¯'},
    {name:'isin', params:[], description:'ISINä»£ç '},
    {name:'options', params:[], description:'æœŸæƒä¿¡æ¯'},
    {name:'institutional_holders', params:[], description:'æœºæ„è‚¡ä¸œ'},
    {name:'mutualfund_holders', params:[], description:'åŸºé‡‘è‚¡ä¸œ'},
    {name:'major_holders', params:[], description:'ä¸»è¦è‚¡ä¸œ'},
    {name:'recommendations', params:['start','end'], description:'åˆ†æå¸ˆæ¨è'},
    {name:'news', params:[], description:'æ–°é—»'},
    {name:'get_income_stmt', params:['start','end'], description:'æ–°ç‰ˆåˆ©æ¶¦è¡¨'},
    {name:'get_balance_sheet', params:['start','end'], description:'æ–°ç‰ˆèµ„äº§è´Ÿå€ºè¡¨'},
    {name:'get_cashflow', params:['start','end'], description:'æ–°ç‰ˆç°é‡‘æµé‡è¡¨'},
    {name:'get_earnings_dates', params:[], description:'æ”¶ç›Šæ—¥æœŸ'}
];

// å­—æ®µè¯´æ˜æ˜ å°„
const FIELD_DESCRIPTIONS = {
    'Date': 'æ—¥æœŸ',
    'Open': 'å¼€ç›˜ä»·',
    'High': 'æœ€é«˜ä»·',
    'Low': 'æœ€ä½ä»·',
    'Close': 'æ”¶ç›˜ä»·',
    'Volume': 'æˆäº¤é‡',
    'Dividends': 'è‚¡æ¯',
    'Stock Splits': 'è‚¡ç¥¨åˆ†å‰²',
    'Adj Close': 'è°ƒæ•´åæ”¶ç›˜ä»·',
    'Market Cap': 'å¸‚å€¼',
    'Enterprise Value': 'ä¼ä¸šä»·å€¼',
    'Trailing P/E': 'å¸‚ç›ˆç‡',
    'Forward P/E': 'é¢„æœŸå¸‚ç›ˆç‡',
    'PEG Ratio': 'PEGæ¯”ç‡',
    'Price/Book': 'å¸‚å‡€ç‡',
    'Price/Sales': 'å¸‚é”€ç‡',
    'Enterprise Value/Revenue': 'ä¼ä¸šä»·å€¼/è¥æ”¶',
    'Enterprise Value/EBITDA': 'ä¼ä¸šä»·å€¼/EBITDA',
    'Profit Margins': 'åˆ©æ¶¦ç‡',
    'Operating Margins': 'è¥ä¸šåˆ©æ¶¦ç‡',
    'Return on Assets': 'èµ„äº§å›æŠ¥ç‡',
    'Return on Equity': 'è‚¡æœ¬å›æŠ¥ç‡',
    'Revenue': 'è¥æ”¶',
    'Revenue Per Share': 'æ¯è‚¡è¥æ”¶',
    'Revenue Growth': 'è¥æ”¶å¢é•¿',
    'Gross Profits': 'æ¯›åˆ©æ¶¦',
    'Free Cashflow': 'è‡ªç”±ç°é‡‘æµ',
    'Operating Cash Flow': 'ç»è¥ç°é‡‘æµ',
    'Earnings Growth': 'æ”¶ç›Šå¢é•¿',
    'Earnings Quality': 'æ”¶ç›Šè´¨é‡',
    'Earnings Before Interest and Taxes': 'æ¯ç¨å‰åˆ©æ¶¦',
    'Net Income to Common': 'æ™®é€šè‚¡å‡€æ”¶å…¥',
    'Total Cash': 'æ€»ç°é‡‘',
    'Total Debt': 'æ€»å€ºåŠ¡',
    'Debt to Equity': 'å€ºåŠ¡è‚¡æœ¬æ¯”',
    'Current Ratio': 'æµåŠ¨æ¯”ç‡',
    'Book Value': 'è´¦é¢ä»·å€¼',
    'Cash Per Share': 'æ¯è‚¡ç°é‡‘',
    'Dividend Rate': 'è‚¡æ¯ç‡',
    'Dividend Yield': 'è‚¡æ¯æ”¶ç›Šç‡',
    'Payout Ratio': 'æ´¾æ¯æ¯”ç‡',
    'Five Year Average Dividend Yield': 'äº”å¹´å¹³å‡è‚¡æ¯æ”¶ç›Šç‡',
    'Beta': 'è´å¡”ç³»æ•°',
    '52 Week Change': '52å‘¨å˜åŒ–',
    'S&P500 52-Week Change': 'æ ‡æ™®500 52å‘¨å˜åŒ–',
    '52 Week High': '52å‘¨æœ€é«˜',
    '52 Week Low': '52å‘¨æœ€ä½',
    '50 Day Average': '50æ—¥å‡çº¿',
    '200 Day Average': '200æ—¥å‡çº¿',
    'Shares Outstanding': 'æµé€šè‚¡æ•°',
    'Float Shares': 'æµé€šè‚¡',
    'Shares Short': 'ç©ºå¤´è‚¡æ•°',
    'Shares Short Prior Month': 'ä¸Šæœˆç©ºå¤´è‚¡æ•°',
    'Short Ratio': 'ç©ºå¤´æ¯”ç‡',
    'Short Percent of Float': 'ç©ºå¤´å æµé€šè‚¡æ¯”ä¾‹',
    'Shares Percent Shares Out': 'æµé€šè‚¡å æ¯”',
    'Held Percent Insiders': 'å†…éƒ¨æŒè‚¡æ¯”ä¾‹',
    'Held Percent Institutions': 'æœºæ„æŒè‚¡æ¯”ä¾‹',
    'Shares Short Previous Month Date': 'ä¸Šæœˆç©ºå¤´æ—¥æœŸ',
    'Forward Annual Dividend Rate': 'é¢„æœŸå¹´è‚¡æ¯ç‡',
    'Forward Annual Dividend Yield': 'é¢„æœŸå¹´è‚¡æ¯æ”¶ç›Šç‡',
    'Trailing Annual Dividend Rate': 'å†å²å¹´è‚¡æ¯ç‡',
    'Trailing Annual Dividend Yield': 'å†å²å¹´è‚¡æ¯æ”¶ç›Šç‡',
    'Average Volume': 'å¹³å‡æˆäº¤é‡',
    'Average Volume 10 Days': '10æ—¥å¹³å‡æˆäº¤é‡',
    'Average Volume 30 Days': '30æ—¥å¹³å‡æˆäº¤é‡',
    'Day Range': 'æ—¥å†…æ³¢åŠ¨èŒƒå›´',
    'Day Low': 'æ—¥å†…æœ€ä½',
    'Day High': 'æ—¥å†…æœ€é«˜',
    'Previous Close': 'å‰æ”¶ç›˜ä»·',
    'Regular Market Open': 'å¸¸è§„å¸‚åœºå¼€ç›˜ä»·',
    'Regular Market Day High': 'å¸¸è§„å¸‚åœºæ—¥å†…æœ€é«˜',
    'Regular Market Day Low': 'å¸¸è§„å¸‚åœºæ—¥å†…æœ€ä½',
    'Regular Market Previous Close': 'å¸¸è§„å¸‚åœºå‰æ”¶ç›˜ä»·',
    'Regular Market Price': 'å¸¸è§„å¸‚åœºä»·æ ¼',
    'Regular Market Volume': 'å¸¸è§„å¸‚åœºæˆäº¤é‡',
    'Regular Market Time': 'å¸¸è§„å¸‚åœºæ—¶é—´',
    'Exchange': 'äº¤æ˜“æ‰€',
    'Currency': 'è´§å¸',
    'Quote Type': 'æŠ¥ä»·ç±»å‹',
    'Symbol': 'è‚¡ç¥¨ä»£ç ',
    'Underlying Symbol': 'åŸºç¡€è‚¡ç¥¨ä»£ç ',
    'Short Name': 'ç®€ç§°',
    'Long Name': 'å…¨ç§°',
    'Full Exchange Name': 'å®Œæ•´äº¤æ˜“æ‰€åç§°',
    'Financial Currency': 'è´¢åŠ¡è´§å¸',
    'Average Analyst Rating': 'åˆ†æå¸ˆå¹³å‡è¯„çº§',
    'Number of Analysts': 'åˆ†æå¸ˆæ•°é‡',
    'Target Mean Price': 'ç›®æ ‡å¹³å‡ä»·æ ¼',
    'Target Median Price': 'ç›®æ ‡ä¸­ä½æ•°ä»·æ ¼',
    'Target High Price': 'ç›®æ ‡æœ€é«˜ä»·æ ¼',
    'Target Low Price': 'ç›®æ ‡æœ€ä½ä»·æ ¼',
    'Recommendation': 'æ¨è',
    'Recommendation Mean': 'æ¨èå¹³å‡å€¼',
    'Number of Recommendations': 'æ¨èæ•°é‡',
    'Strong Buy': 'å¼ºçƒˆä¹°å…¥',
    'Buy': 'ä¹°å…¥',
    'Hold': 'æŒæœ‰',
    'Sell': 'å–å‡º',
    'Strong Sell': 'å¼ºçƒˆå–å‡º',
    'From Grade': 'è¯„çº§æ¥æº',
    'To Grade': 'è¯„çº§ç›®æ ‡',
    'Action': 'è¡ŒåŠ¨',
    'Firm': 'æœºæ„',
    'Date': 'æ—¥æœŸ',
    'Title': 'æ ‡é¢˜',
    'Link': 'é“¾æ¥',
    'Provider': 'æä¾›è€…',
    'Type': 'ç±»å‹',
    'Related Symbols': 'ç›¸å…³è‚¡ç¥¨',
    'Summary': 'æ‘˜è¦',
    'Publish Time': 'å‘å¸ƒæ—¶é—´',
    'Provider Publish Time': 'æä¾›è€…å‘å¸ƒæ—¶é—´',
    'Age': 'å¹´é¾„',
    'Uuid': 'å”¯ä¸€æ ‡è¯†',
    'Spark': 'ç«èŠ±å›¾',
    'Spark Chart': 'ç«èŠ±å›¾',
    'Spark Chart Previous Close': 'ç«èŠ±å›¾å‰æ”¶ç›˜ä»·',
    'Spark Chart Symbol': 'ç«èŠ±å›¾è‚¡ç¥¨ä»£ç ',
    'Spark Chart End': 'ç«èŠ±å›¾ç»“æŸ',
    'Spark Chart Start': 'ç«èŠ±å›¾å¼€å§‹',
    'Spark Chart Timestamp': 'ç«èŠ±å›¾æ—¶é—´æˆ³',
    'Spark Chart Data': 'ç«èŠ±å›¾æ•°æ®',
    'Spark Chart Symbol': 'ç«èŠ±å›¾è‚¡ç¥¨ä»£ç ',
    'Spark Chart Previous Close': 'ç«èŠ±å›¾å‰æ”¶ç›˜ä»·',
    'Spark Chart End': 'ç«èŠ±å›¾ç»“æŸ',
    'Spark Chart Start': 'ç«èŠ±å›¾å¼€å§‹',
    'Spark Chart Timestamp': 'ç«èŠ±å›¾æ—¶é—´æˆ³',
    'Spark Chart Data': 'ç«èŠ±å›¾æ•°æ®'
};

function getParamValue(methodName, paramName) {
    const elementId = `${methodName}_${paramName}`;
    const element = document.getElementById(elementId);
    if (!element) return null;
    
    if (element.type === 'checkbox') {
        return element.checked;
    } else if (element.type === 'date') {
        return element.value || null;
    } else {
        return element.value || null;
    }
}

function analyzeData(data, methodName) {
    if (!data || data.length === 0) return null;
    
    const analysis = {
        totalRecords: data.length,
        fields: [],
        numericFields: [],
        dateFields: [],
        sampleData: data.slice(0, 3)
    };
    
    if (data.length > 0) {
        const firstRecord = data[0];
        analysis.fields = Object.keys(firstRecord);
        
        analysis.fields.forEach(field => {
            const value = firstRecord[field];
            if (typeof value === 'number' || !isNaN(parseFloat(value))) {
                analysis.numericFields.push(field);
            } else if (field.toLowerCase().includes('date') || 
                      (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}/))) {
                analysis.dateFields.push(field);
            }
        });
    }
    
    return analysis;
}

function formatValue(value, fieldName) {
    if (value === null || value === undefined || value === '') {
        return '-';
    }
    
    // æ—¥æœŸæ ¼å¼åŒ–
    if (fieldName.toLowerCase().includes('date') || 
        (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}/))) {
        return `<span class="date-cell">${value}</span>`;
    }
    
    // æ•°å­—æ ¼å¼åŒ–
    if (typeof value === 'number' || !isNaN(parseFloat(value))) {
        const num = parseFloat(value);
        if (fieldName.toLowerCase().includes('price') || fieldName.toLowerCase().includes('close') || 
            fieldName.toLowerCase().includes('open') || fieldName.toLowerCase().includes('high') || 
            fieldName.toLowerCase().includes('low')) {
            return `<span class="numeric-cell">$${num.toFixed(2)}</span>`;
        } else if (fieldName.toLowerCase().includes('volume')) {
            return `<span class="numeric-cell">${num.toLocaleString()}</span>`;
        } else if (fieldName.toLowerCase().includes('percent') || fieldName.toLowerCase().includes('ratio')) {
            return `<span class="numeric-cell">${num.toFixed(2)}%</span>`;
        } else {
            return `<span class="numeric-cell">${num.toLocaleString()}</span>`;
        }
    }
    
    return value;
}

function createDataAnalysisHTML(analysis, methodName) {
    if (!analysis) return '';
    
    let html = '<div class="data-analysis">';
    html += `<div class="analysis-title">ğŸ“Š æ•°æ®è§£æ (${methodName})</div>`;
    html += `<div class="analysis-item"><span class="analysis-label">æ€»è®°å½•æ•°:</span> <span class="analysis-value">${analysis.totalRecords}</span></div>`;
    html += `<div class="analysis-item"><span class="analysis-label">å­—æ®µæ•°é‡:</span> <span class="analysis-value">${analysis.fields.length}</span></div>`;
    
    if (analysis.numericFields.length > 0) {
        html += `<div class="analysis-item"><span class="analysis-label">æ•°å€¼å­—æ®µ:</span> <span class="analysis-value">${analysis.numericFields.join(', ')}</span></div>`;
    }
    
    if (analysis.dateFields.length > 0) {
        html += `<div class="analysis-item"><span class="analysis-label">æ—¥æœŸå­—æ®µ:</span> <span class="analysis-value">${analysis.dateFields.join(', ')}</span></div>`;
    }
    
    html += '</div>';
    return html;
}

function createTableHTML(data, columns, methodName) {
    if (!data || data.length === 0) return '<span class="error">æ— æ•°æ®</span>';
    
    const analysis = analyzeData(data, methodName);
    
    let html = '';
    
    // æ·»åŠ æ•°æ®è§£æ
    html += createDataAnalysisHTML(analysis, methodName);
    
    // æ·»åŠ å¯¼å‡ºæŒ‰é’®
    html += `<button class="btn export-btn btn-sm mt-2" onclick="exportToCSV('${methodName}', ${JSON.stringify(data)})">ğŸ“¥ å¯¼å‡ºCSV</button>`;
    
    // åˆ›å»ºæ ‡ç­¾é¡µ
    html += '<ul class="nav nav-tabs mt-2" role="tablist">';
    html += '<li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#table_' + methodName + '">è¡¨æ ¼è§†å›¾</a></li>';
    html += '<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#json_' + methodName + '">JSONè§†å›¾</a></li>';
    html += '<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#fields_' + methodName + '">å­—æ®µè¯´æ˜</a></li>';
    html += '</ul>';
    
    html += '<div class="tab-content">';
    
    // è¡¨æ ¼è§†å›¾
    html += '<div class="tab-pane fade show active" id="table_' + methodName + '">';
    html += '<div class="data-preview">';
    html += '<table class="table table-sm table-dark"><thead><tr>';
    columns.forEach(col => {
        const description = FIELD_DESCRIPTIONS[col] || col;
        html += `<th title="${description}">${col}</th>`;
    });
    html += '</tr></thead><tbody>';
    
    data.forEach(row => {
        html += '<tr>';
        columns.forEach(col => {
            html += `<td>${formatValue(row[col], col)}</td>`;
        });
        html += '</tr>';
    });
    
    html += '</tbody></table>';
    html += '</div></div>';
    
    // JSONè§†å›¾
    html += '<div class="tab-pane fade" id="json_' + methodName + '">';
    html += '<pre class="result-json">' + JSON.stringify(data, null, 2) + '</pre>';
    html += '</div>';
    
    // å­—æ®µè¯´æ˜è§†å›¾
    html += '<div class="tab-pane fade" id="fields_' + methodName + '">';
    html += '<div class="field-info">';
    columns.forEach(col => {
        const description = FIELD_DESCRIPTIONS[col] || 'æš‚æ— è¯´æ˜';
        html += `<div><strong>${col}:</strong> ${description}</div>`;
    });
    html += '</div></div>';
    
    html += '</div>';
    
    return html;
}

function createInfoHTML(data, methodName) {
    if (!data || typeof data !== 'object') return '<span class="error">æ— æ•°æ®</span>';
    
    let html = '';
    
    // æ·»åŠ æ•°æ®è§£æ
    html += '<div class="data-analysis">';
    html += `<div class="analysis-title">ğŸ“Š åŸºæœ¬ä¿¡æ¯è§£æ (${methodName})</div>`;
    html += `<div class="analysis-item"><span class="analysis-label">ä¿¡æ¯å­—æ®µæ•°:</span> <span class="analysis-value">${Object.keys(data).length}</span></div>`;
    html += '</div>';
    
    // æ·»åŠ å¯¼å‡ºæŒ‰é’®
    const dataArray = Object.keys(data).map(key => ({å­—æ®µ: key, å€¼: data[key], è¯´æ˜: FIELD_DESCRIPTIONS[key] || 'æš‚æ— è¯´æ˜'}));
    html += `<button class="btn export-btn btn-sm mt-2" onclick="exportToCSV('${methodName}', ${JSON.stringify(dataArray)})">ğŸ“¥ å¯¼å‡ºCSV</button>`;
    
    // åˆ›å»ºæ ‡ç­¾é¡µ
    html += '<ul class="nav nav-tabs mt-2" role="tablist">';
    html += '<li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#info_' + methodName + '">ä¿¡æ¯è§†å›¾</a></li>';
    html += '<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#json_' + methodName + '">JSONè§†å›¾</a></li>';
    html += '<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#categorized_' + methodName + '">åˆ†ç±»è§†å›¾</a></li>';
    html += '</ul>';
    
    html += '<div class="tab-content">';
    
    // ä¿¡æ¯è§†å›¾
    html += '<div class="tab-pane fade show active" id="info_' + methodName + '">';
    html += '<div class="data-preview">';
    html += '<table class="table table-sm table-dark"><thead><tr>';
    html += '<th>å­—æ®µ</th><th>å€¼</th><th>è¯´æ˜</th>';
    html += '</tr></thead><tbody>';
    
    Object.keys(data).forEach(key => {
        const value = data[key];
        const description = FIELD_DESCRIPTIONS[key] || 'æš‚æ— è¯´æ˜';
        html += '<tr>';
        html += `<td><strong>${key}</strong></td>`;
        html += `<td>${formatInfoValue(value, key)}</td>`;
        html += `<td class="field-info">${description}</td>`;
        html += '</tr>';
    });
    
    html += '</tbody></table>';
    html += '</div></div>';
    
    // JSONè§†å›¾
    html += '<div class="tab-pane fade" id="json_' + methodName + '">';
    html += '<pre class="result-json">' + JSON.stringify(data, null, 2) + '</pre>';
    html += '</div>';
    
    // åˆ†ç±»è§†å›¾
    html += '<div class="tab-pane fade" id="categorized_' + methodName + '">';
    html += createCategorizedInfoHTML(data);
    html += '</div>';
    
    html += '</div>';
    
    return html;
}

function formatInfoValue(value, fieldName) {
    if (value === null || value === undefined || value === '') {
        return '-';
    }
    
    // å¸ƒå°”å€¼
    if (typeof value === 'boolean') {
        return value ? '<span class="positive">æ˜¯</span>' : '<span class="negative">å¦</span>';
    }
    
    // æ—¥æœŸæ ¼å¼åŒ–
    if (fieldName.toLowerCase().includes('date') || fieldName.toLowerCase().includes('time')) {
        if (typeof value === 'number') {
            // Unixæ—¶é—´æˆ³
            const date = new Date(value * 1000);
            return `<span class="date-cell">${date.toLocaleDateString('zh-CN')}</span>`;
        } else if (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}/)) {
            return `<span class="date-cell">${value}</span>`;
        }
    }
    
    // æ•°å­—æ ¼å¼åŒ–
    if (typeof value === 'number') {
        // ä»·æ ¼ç›¸å…³
        if (fieldName.toLowerCase().includes('price') || 
            fieldName.toLowerCase().includes('close') || 
            fieldName.toLowerCase().includes('open') || 
            fieldName.toLowerCase().includes('high') || 
            fieldName.toLowerCase().includes('low') ||
            fieldName.toLowerCase().includes('target')) {
            return `<span class="numeric-cell">$${value.toFixed(2)}</span>`;
        }
        // å¸‚å€¼ç›¸å…³ï¼ˆå¤§æ•°å€¼ï¼‰
        else if (fieldName.toLowerCase().includes('cap') || 
                 fieldName.toLowerCase().includes('value') ||
                 fieldName.toLowerCase().includes('revenue') ||
                 fieldName.toLowerCase().includes('profit')) {
            if (value >= 1e12) {
                return `<span class="numeric-cell">$${(value / 1e12).toFixed(2)}T</span>`;
            } else if (value >= 1e9) {
                return `<span class="numeric-cell">$${(value / 1e9).toFixed(2)}B</span>`;
            } else if (value >= 1e6) {
                return `<span class="numeric-cell">$${(value / 1e6).toFixed(2)}M</span>`;
            } else if (value >= 1e3) {
                return `<span class="numeric-cell">$${(value / 1e3).toFixed(2)}K</span>`;
            } else {
                return `<span class="numeric-cell">$${value.toLocaleString()}</span>`;
            }
        }
        // æˆäº¤é‡
        else if (fieldName.toLowerCase().includes('volume') || 
                 fieldName.toLowerCase().includes('shares')) {
            if (value >= 1e9) {
                return `<span class="numeric-cell">${(value / 1e9).toFixed(2)}B</span>`;
            } else if (value >= 1e6) {
                return `<span class="numeric-cell">${(value / 1e6).toFixed(2)}M</span>`;
            } else if (value >= 1e3) {
                return `<span class="numeric-cell">${(value / 1e3).toFixed(2)}K</span>`;
            } else {
                return `<span class="numeric-cell">${value.toLocaleString()}</span>`;
            }
        }
        // ç™¾åˆ†æ¯”
        else if (fieldName.toLowerCase().includes('margin') || 
                 fieldName.toLowerCase().includes('ratio') ||
                 fieldName.toLowerCase().includes('yield') ||
                 fieldName.toLowerCase().includes('growth') ||
                 fieldName.toLowerCase().includes('change') ||
                 fieldName.toLowerCase().includes('percent')) {
            const percentage = value * 100;
            const colorClass = percentage > 0 ? 'positive' : (percentage < 0 ? 'negative' : '');
            return `<span class="numeric-cell ${colorClass}">${percentage.toFixed(2)}%</span>`;
        }
        // å€æ•°ï¼ˆå¦‚P/E, P/Bç­‰ï¼‰
        else if (fieldName.toLowerCase().includes('p/e') || 
                 fieldName.toLowerCase().includes('p/b') ||
                 fieldName.toLowerCase().includes('peg') ||
                 fieldName.toLowerCase().includes('beta')) {
            return `<span class="numeric-cell">${value.toFixed(2)}x</span>`;
        }
        // æ™®é€šæ•°å­—
        else {
            return `<span class="numeric-cell">${value.toLocaleString()}</span>`;
        }
    }
    
    // å­—ç¬¦ä¸²å¤„ç†
    if (typeof value === 'string') {
        // URLé“¾æ¥
        if (value.startsWith('http')) {
            return `<a href="${value}" target="_blank" style="color: #00d4aa;">${value.substring(0, 50)}...</a>`;
        }
        // é•¿æ–‡æœ¬æˆªæ–­
        if (value.length > 100) {
            return `<span title="${value}">${value.substring(0, 100)}...</span>`;
        }
    }
    
    return value;
}

function createCategorizedInfoHTML(data) {
    const categories = {
        'åŸºæœ¬ä¿¡æ¯': ['symbol', 'shortName', 'longName', 'sector', 'industry', 'country', 'city', 'website', 'exchange', 'currency', 'quoteType'],
        'ä»·æ ¼ä¿¡æ¯': ['currentPrice', 'previousClose', 'open', 'dayLow', 'dayHigh', 'regularMarketPrice', 'regularMarketOpen', 'regularMarketDayLow', 'regularMarketDayHigh', 'regularMarketPreviousClose'],
        'å¸‚åœºæ•°æ®': ['marketCap', 'enterpriseValue', 'sharesOutstanding', 'floatShares', 'volume', 'averageVolume', 'averageVolume10days'],
        'ä¼°å€¼æŒ‡æ ‡': ['trailingPE', 'forwardPE', 'pegRatio', 'priceToBook', 'priceToSalesTrailing12Months', 'enterpriseToRevenue', 'enterpriseToEbitda'],
        'è´¢åŠ¡æŒ‡æ ‡': ['profitMargins', 'operatingMargins', 'returnOnAssets', 'returnOnEquity', 'revenue', 'revenuePerShare', 'totalRevenue', 'grossProfits', 'freeCashflow', 'operatingCashflow'],
        'è‚¡æ¯ä¿¡æ¯': ['dividendRate', 'dividendYield', 'payoutRatio', 'fiveYearAvgDividendYield', 'trailingAnnualDividendRate', 'trailingAnnualDividendYield'],
        'æŠ€æœ¯æŒ‡æ ‡': ['beta', '52WeekChange', 'SandP52WeekChange', 'fiftyTwoWeekHigh', 'fiftyTwoWeekLow', 'fiftyDayAverage', 'twoHundredDayAverage'],
        'åˆ†æå¸ˆæ•°æ®': ['recommendationMean', 'recommendationKey', 'numberOfAnalystOpinions', 'targetHighPrice', 'targetLowPrice', 'targetMeanPrice', 'targetMedianPrice']
    };
    
    let html = '<div class="row">';
    
    Object.keys(categories).forEach(category => {
        const fields = categories[category];
        const categoryData = {};
        fields.forEach(field => {
            if (data.hasOwnProperty(field)) {
                categoryData[field] = data[field];
            }
        });
        
        if (Object.keys(categoryData).length > 0) {
            html += '<div class="col-md-6 mb-3">';
            html += `<div class="card"><div class="card-header"><h6 class="mb-0">${category}</h6></div><div class="card-body">`;
            html += '<table class="table table-sm table-dark mb-0"><tbody>';
            
            Object.keys(categoryData).forEach(key => {
                const description = FIELD_DESCRIPTIONS[key] || key;
                html += '<tr>';
                html += `<td style="width: 40%"><small>${description}</small></td>`;
                html += `<td>${formatInfoValue(categoryData[key], key)}</td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div></div>';
        }
    });
    
    html += '</div>';
    return html;
}

function exportToCSV(methodName, data) {
    if (!data || data.length === 0) {
        alert('æ— æ•°æ®å¯å¯¼å‡º');
        return;
    }
    
    const columns = Object.keys(data[0]);
    let csv = columns.join(',') + '\n';
    
    data.forEach(row => {
        const values = columns.map(col => {
            const value = row[col];
            if (value === null || value === undefined) return '';
            return `"${String(value).replace(/"/g, '""')}"`;
        });
        csv += values.join(',') + '\n';
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `${methodName}_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

async function testMethod(methodName) {
    const symbol = document.getElementById('symbol').value.trim();
    const resultDiv = document.getElementById(`yf_${methodName}_result`);
    
    if (!symbol) {
        resultDiv.innerHTML = '<span class="error">è¯·è¾“å…¥è‚¡ç¥¨ä»£ç </span>';
        return;
    }
    
    resultDiv.innerHTML = '<span class="loading">åŠ è½½ä¸­...</span>';
    
    try {
        let url = `/api/yfinance_test?symbol=${encodeURIComponent(symbol)}&method=${methodName}`;
        
        // è·å–æ–¹æ³•å¯¹åº”çš„å‚æ•°
        const method = YF_METHODS.find(m => m.name === methodName);
        if (method && method.params) {
            method.params.forEach(param => {
                const value = getParamValue(methodName, param);
                if (value !== null && value !== '') {
                    if (typeof value === 'boolean') {
                        url += `&${param}=${value}`;
                    } else {
                        url += `&${param}=${encodeURIComponent(value)}`;
                    }
                }
            });
        }
        
        const resp = await fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        });
        
        if (!resp.ok) {
            throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);
        }
        
        const data = await resp.json();
        
        if (data.success) {
            if (Array.isArray(data.data)) {
                if (data.data.length > 0 && data.columns) {
                    resultDiv.innerHTML = createTableHTML(data.data, data.columns, methodName);
                } else {
                    resultDiv.innerHTML = `<pre class='result-json'>${JSON.stringify(data.data, null, 2)}</pre>`;
                }
            } else if (typeof data.data === 'object' && data.data !== null) {
                // ç‰¹æ®Šå¤„ç†infoæ¥å£çš„å¯¹è±¡æ•°æ®
                if (methodName === 'info') {
                    resultDiv.innerHTML = createInfoHTML(data.data, methodName);
                } else {
                    resultDiv.innerHTML = `<pre class='result-json'>${JSON.stringify(data.data, null, 2)}</pre>`;
                }
            } else {
                resultDiv.innerHTML = `<span class="success">${data.data}</span>`;
            }
        } else {
            resultDiv.innerHTML = `<span class="error">${data.error || 'æ¥å£é”™è¯¯'}</span>`;
        }
    } catch (e) {
        console.error('è¯·æ±‚é”™è¯¯:', e);
        resultDiv.innerHTML = `<span class="error">è¯·æ±‚é”™è¯¯: ${e.message}</span>`;
    }
}

async function testAllYF() {
    const symbol = document.getElementById('symbol').value.trim();
    if (!symbol) {
        alert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
        return;
    }
    
    for (const method of YF_METHODS) {
        await testMethod(method.name);
        // æ·»åŠ å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
        await new Promise(resolve => setTimeout(resolve, 100));
    }
}

function clearAllResults() {
    YF_METHODS.forEach(method => {
        const resultDiv = document.getElementById(`yf_${method.name}_result`);
        if (resultDiv) {
            resultDiv.innerHTML = '';
        }
    });
}
</script>
</body>
</html> 